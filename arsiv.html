<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PZHNKJSF0L"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-PZHNKJSF0L');</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0d4d3d">
  <meta name="description" content="Ahmetli Medya - Haber arşivi ve kategoriler">
  <meta property="og:title" content="Haber Arşivi - Ahmetli Medya">
  <meta property="og:description" content="Tüm haberler, kategoriye göre filtrele">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ahmetlisosyal.com.tr/arsiv.html">
  <meta property="og:locale" content="tr_TR">
  <meta property="og:site_name" content="Ahmetli Medya">
  <title>Haber Arşivi - Ahmetli Medya</title>
  <link rel="canonical" href="https://ahmetlisosyal.com.tr/arsiv.html">
  <link rel="alternate" type="application/rss+xml" title="Ahmetli Medya RSS" href="/api/rss">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%230d4d3d'/%3E%3Ctext x='16' y='23' text-anchor='middle' font-family='Georgia,serif' font-size='22' font-weight='700' fill='white'%3EA%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&family=Figtree:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Ana Sayfa", "item": "https://ahmetlisosyal.com.tr/" },
      { "@type": "ListItem", "position": 2, "name": "Haber Arşivi", "item": "https://ahmetlisosyal.com.tr/arsiv.html" }
    ]
  }
  </script>
</head>
<body>
  <a href="#main-content" class="skip-link">İçeriğe atla</a>

  <div class="top-bar">
    <div class="container top-bar__inner">
      <span class="date" id="currentDate"></span>
      <div class="top-bar__right">
        <button type="button" class="theme-toggle" id="theme-toggle" aria-label="Karanlık mod">&#9790;</button>
        <nav class="top-nav">
          <a href="index.html">Ana Sayfa</a>
        </nav>
      </div>
    </div>
  </div>

  <header class="main-header">
    <div class="main-header__pattern" aria-hidden="true"></div>
    <div class="container main-header__inner">
      <a href="index.html" class="logo">
        <span class="logo__mark" aria-hidden="true">A</span>
        <span class="logo__word logo__word--ahmetli">Ahmetli</span> <span class="logo__word logo__word--medya">Medya</span>
      </a>
    </div>
  </header>

  <nav class="main-nav">
    <div class="container main-nav__inner">
      <ul class="nav-list">
        <li><a href="index.html" class="nav-link">Ana Sayfa</a></li>
        <li><a href="arsiv.html" class="nav-link active">Arşiv</a></li>
        <li><a href="arsiv.html?kategori=Gündem" class="nav-link">Gündem</a></li>
        <li><a href="arsiv.html?kategori=Ekonomi" class="nav-link">Ekonomi</a></li>
        <li><a href="arsiv.html?kategori=Spor" class="nav-link">Spor</a></li>
        <li><a href="dolmus.html" class="nav-link">Dolmuş Saatleri</a></li>
      </ul>
      <button type="button" class="nav-toggle" aria-label="Menü" aria-expanded="false" aria-controls="main-menu">
        <span class="nav-toggle__bar"></span>
        <span class="nav-toggle__bar"></span>
        <span class="nav-toggle__bar"></span>
      </button>
    </div>
    <div id="main-menu" class="nav-overlay" aria-hidden="true">
      <ul class="nav-list nav-list--overlay">
        <li><a href="index.html" class="nav-link">Ana Sayfa</a></li>
        <li><a href="arsiv.html" class="nav-link">Arşiv</a></li>
        <li><a href="arsiv.html?kategori=Gündem" class="nav-link">Gündem</a></li>
        <li><a href="arsiv.html?kategori=Üzüm %26 Bağcılık" class="nav-link">Üzüm & Bağcılık</a></li>
        <li><a href="arsiv.html?kategori=Ekonomi" class="nav-link">Ekonomi</a></li>
        <li><a href="arsiv.html?kategori=Spor" class="nav-link">Spor</a></li>
        <li><a href="arsiv.html?kategori=Magazin" class="nav-link">Magazin</a></li>
        <li><a href="arsiv.html?kategori=Kültür-Sanat" class="nav-link">Kültür-Sanat</a></li>
        <li><a href="arsiv.html?kategori=Teknoloji" class="nav-link">Teknoloji</a></li>
        <li><a href="arsiv.html?kategori=Yaşam" class="nav-link">Yaşam</a></li>
      </ul>
    </div>
  </nav>

  <main id="main-content">
    <div class="container">
      <div class="arsiv-sayfa">
        <h1 class="arsiv-sayfa__baslik" id="arsiv-baslik">Haber Arşivi</h1>

        <div class="arsiv-filtre" id="arsiv-filtre">
          <a href="arsiv.html" class="arsiv-filtre__btn active">Tümü</a>
          <a href="arsiv.html?kategori=Gündem" class="arsiv-filtre__btn">Gündem</a>
          <a href="arsiv.html?kategori=Üzüm %26 Bağcılık" class="arsiv-filtre__btn">Üzüm & Bağcılık</a>
          <a href="arsiv.html?kategori=Ekonomi" class="arsiv-filtre__btn">Ekonomi</a>
          <a href="arsiv.html?kategori=Spor" class="arsiv-filtre__btn">Spor</a>
          <a href="arsiv.html?kategori=Magazin" class="arsiv-filtre__btn">Magazin</a>
          <a href="arsiv.html?kategori=Kültür-Sanat" class="arsiv-filtre__btn">Kültür-Sanat</a>
          <a href="arsiv.html?kategori=Teknoloji" class="arsiv-filtre__btn">Teknoloji</a>
          <a href="arsiv.html?kategori=Yaşam" class="arsiv-filtre__btn">Yaşam</a>
        </div>

        <div class="arsiv-grid" id="arsiv-grid">
          <p>Haberler yükleniyor...</p>
        </div>

        <div class="arsiv-sayfalama" id="arsiv-sayfalama" hidden></div>
      </div>
    </div>
  </main>

  <footer class="main-footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <a href="index.html" class="footer-logo">Ahmetli Medya</a>
          <p>Üzüm diyarından yerel haberler, güvenilir kaynak.</p>
        </div>
        <div class="footer-col">
          <h4>Kurumsal</h4>
          <ul>
            <li><a href="hakkimizda.html">Hakkımızda</a></li>
            <li><a href="iletisim.html">İletişim</a></li>
            <li><a href="gizlilik.html">Gizlilik</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Kategoriler</h4>
          <ul>
            <li><a href="arsiv.html?kategori=Gündem">Gündem</a></li>
            <li><a href="arsiv.html?kategori=Ekonomi">Ekonomi</a></li>
            <li><a href="arsiv.html?kategori=Spor">Spor</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>İletişim</h4>
          <p><a href="mailto:info@ahmetlimedya.com">info@ahmetlimedya.com</a></p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; <span id="footer-year">2025</span> Ahmetli Medya. Tüm hakları saklıdır.</p>
      </div>
    </div>
  </footer>

  <script>
  (function() {
    // Dark mode
    var saved = localStorage.getItem('ahmetli-theme');
    if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
    var btn = document.getElementById('theme-toggle');
    if (btn) {
      function u() { var d = document.documentElement.getAttribute('data-theme') === 'dark'; btn.innerHTML = d ? '&#9788;' : '&#9790;'; }
      u();
      btn.addEventListener('click', function() {
        var d = document.documentElement.getAttribute('data-theme') === 'dark';
        if (d) { document.documentElement.removeAttribute('data-theme'); localStorage.setItem('ahmetli-theme', 'light'); }
        else { document.documentElement.setAttribute('data-theme', 'dark'); localStorage.setItem('ahmetli-theme', 'dark'); }
        u();
      });
    }

    // Date + footer year
    var dateEl = document.getElementById('currentDate');
    if (dateEl) dateEl.textContent = new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    var yrEl = document.getElementById('footer-year');
    if (yrEl) yrEl.textContent = new Date().getFullYear();

    // Mobile menu
    var toggle = document.querySelector('.nav-toggle');
    var overlay = document.getElementById('main-menu');
    if (toggle && overlay) {
      toggle.addEventListener('click', function() {
        var open = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', !open);
        overlay.setAttribute('aria-hidden', open);
        overlay.classList.toggle('is-open', !open);
        document.body.classList.toggle('nav-open', !open);
      });
    }

    // Helpers
    function escapeHtml(s) {
      if (!s) return '';
      var d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    function zamanOnce(dateStr) {
      if (!dateStr) return '';
      try {
        var now = new Date();
        var d = new Date(dateStr);
        var diff = now - d;
        var dakika = Math.floor(diff / 60000);
        if (dakika < 1) return 'Az önce';
        if (dakika < 60) return dakika + ' dk önce';
        var saat = Math.floor(dakika / 60);
        if (saat < 24) return saat + ' saat önce';
        var gun = Math.floor(saat / 24);
        if (gun === 1) return 'Dün';
        if (gun < 7) return gun + ' gün önce';
        return d.toLocaleDateString('tr-TR', { day: '2-digit', month: 'long', year: 'numeric' });
      } catch (e) { return ''; }
    }

    // Parse query parameters
    var params = new URLSearchParams(window.location.search);
    var kategori = params.get('kategori') || '';
    var sayfa = parseInt(params.get('sayfa'), 10) || 1;

    // Update page title and heading
    var baslikEl = document.getElementById('arsiv-baslik');
    if (kategori) {
      document.title = kategori + ' Haberleri - Ahmetli Medya';
      if (baslikEl) baslikEl.textContent = kategori + ' Haberleri';
    }

    // Highlight active filter
    var filtreBtns = document.querySelectorAll('.arsiv-filtre__btn');
    filtreBtns.forEach(function(btn) {
      btn.classList.remove('active');
      var btnUrl = new URL(btn.href);
      var btnKat = new URLSearchParams(btnUrl.search).get('kategori') || '';
      if (btnKat === kategori) btn.classList.add('active');
    });

    // Highlight active nav link
    var navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(function(link) {
      link.classList.remove('active');
      if (link.href.includes('arsiv.html')) {
        var linkUrl = new URL(link.href);
        var linkKat = new URLSearchParams(linkUrl.search).get('kategori') || '';
        if (linkKat === kategori) link.classList.add('active');
      }
    });

    // Load news
    var apiUrl = '/api/haberler?limit=12&sayfa=' + sayfa;
    if (kategori) apiUrl += '&kategori=' + encodeURIComponent(kategori);

    fetch(apiUrl)
      .then(function(res) { return res.json(); })
      .then(function(result) {
        var haberler = result.data || [];
        var grid = document.getElementById('arsiv-grid');
        if (!grid) return;

        if (haberler.length === 0) {
          grid.innerHTML = '<p class="arsiv-bos">Bu kategoride henüz haber bulunmuyor.</p>';
          return;
        }

        grid.innerHTML = haberler.map(function(h) {
          var href = 'haber.html?slug=' + encodeURIComponent(h.slug);
          return '<article class="arsiv-kart">'
            + '<a href="' + href + '" class="arsiv-kart__link">'
            + (h.gorsel ? '<div class="arsiv-kart__img"><img src="' + escapeHtml(h.gorsel) + '" alt="" width="400" height="250" loading="lazy"></div>' : '')
            + '<div class="arsiv-kart__body">'
            + '<span class="arsiv-kart__kategori">' + escapeHtml(h.kategori) + '</span>'
            + '<h2 class="arsiv-kart__title">' + escapeHtml(h.baslik) + '</h2>'
            + (h.ozet ? '<p class="arsiv-kart__ozet">' + escapeHtml(h.ozet) + '</p>' : '')
            + '<span class="arsiv-kart__meta">' + escapeHtml(h.yazar || 'Editör') + ' · ' + zamanOnce(h.yayinTarihi) + '</span>'
            + '</div>'
            + '</a>'
            + '</article>';
        }).join('');

        // Broken image fallback
        grid.querySelectorAll('img').forEach(function(img) {
          img.onerror = function() {
            this.onerror = null;
            this.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="250" viewBox="0 0 400 250"%3E%3Crect fill="%23e8e8e8" width="400" height="250"/%3E%3Ctext x="200" y="125" text-anchor="middle" fill="%23999" font-family="sans-serif" font-size="16"%3EGörsel yüklenemedi%3C/text%3E%3C/svg%3E';
          };
        });

        // Pagination
        if (result.toplamSayfa > 1) {
          var pagEl = document.getElementById('arsiv-sayfalama');
          if (pagEl) {
            pagEl.hidden = false;
            var html = '';
            for (var i = 1; i <= result.toplamSayfa; i++) {
              var pUrl = 'arsiv.html?sayfa=' + i;
              if (kategori) pUrl += '&kategori=' + encodeURIComponent(kategori);
              html += '<a href="' + pUrl + '" class="arsiv-sayfalama__btn' + (i === sayfa ? ' active' : '') + '">' + i + '</a>';
            }
            pagEl.innerHTML = html;
          }
        }
      })
      .catch(function() {
        var grid = document.getElementById('arsiv-grid');
        if (grid) grid.innerHTML = '<p class="arsiv-bos">Haberler yüklenemedi.</p>';
      });
  })();
  </script>
</body>
</html>
